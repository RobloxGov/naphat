<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ลงทะเบียนเข้าร่วมกิจกรรม</title>
    <link rel="stylesheet" href="css/style.css">
    <style>input, button { font-family: inherit; }.d-flex { display: flex ; justify-content: space-between; }</style>
    <script src="js/myscript.js"></script>
    <link rel="icon" href="/public/assets/images/NAPHAT_DEV.png" type="image/png">
    <link href="https://fonts.googleapis.com/css2?family=Anuphan:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="registration-container">
        <header>
            <img src="/public/assets/images/NAPHAT_DEV.png" width="100px">
            <p>ลงทะเบียนเข้าร่วมกิจกรรม</p>
        </header>
        <section class="registration-details">
            <h2>การประชุมใหญ่สามัญประจำปี 2568</h2>
            <p><strong>วันที่:</strong> 4 พฤษภาคม 2568 เวลา 13.00 น.</p>
            <p><strong>ปิดรับลงทะเบียน:</strong> 30 เมษายน 2568</p>
        </section>
        <form id="form" method="POST" class="registration-form">
            <div class="d-flex">
                <label for="id-number">เลขบัตรประชาชน</label>
                <div id="success"></div>
            </div>
            <input type="text" id="id-number" name="id-number" oninput="formatInput(event)" placeholder="1-2345-67890-12-3">
            
            <label for="depart">ชื่อหน่วยงาน/แผนก</label>
            <input type="text" id="depart" name="depart" placeholder="กรุณากรอก">
            
            <button type="submit" type="submit" id="submit-button" class="btn btn-primary button is-primary">ลงทะเบียนเข้าร่วมกิจกรรม</button>
            <button class="button is-danger" style="display:none;">Cancel</button>
          </form>
          <div id="message" style=" display: none; margin: 20px; font-weight: bold; color: green; padding: 8px; background-color: beige; border-radius: 4px; border-color: aquamarine; " ></div>
        <footer>
            <p style="display: none;">วัตถุประสงค์เพื่อลงทะเบียนรับหน่วย CPD ที่เกี่ยวข้องกับกิจกรรม</p>
        </footer>
    </div>
    
  <script>
      document.getElementById("form").addEventListener("submit", function (e) {
        e.preventDefault(); // Prevent the default form submission
        document.getElementById("message").textContent = "Submitting..";
        document.getElementById("message").style.display = "block";
        document.getElementById("submit-button").disabled = true;

        // Collect the form data
        var formData = new FormData(this);
        var keyValuePairs = [];
        for (var pair of formData.entries()) {
          keyValuePairs.push(pair[0] + "=" + pair[1]);
        }

        var formDataString = keyValuePairs.join("&");

        // Send a POST request to your Google Apps Script
        fetch(
          "https://script.google.com/macros/s/AKfycbwZrc9UhxitHsw5MMkyqqdw8UEvWkWpdbKhfLYUe4layxLsYqfvsrwuW0j6GP14YPjs/exec",
          {
            redirect: "follow",
            method: "POST",
            body: formDataString,
            headers: {
              "Content-Type": "text/plain;charset=utf-8",
            },
          }
        )
          .then(function (response) {
            // Check if the request was successful
            if (response) {
              return response; // Assuming your script returns JSON response
            } else {
              throw new Error("Failed to submit the form.");
            }
          })
          .then(function (data) {
            // Display a success message
            document.getElementById("message").textContent =
              "Data submitted successfully!";
            document.getElementById("message").style.display = "block";
            document.getElementById("message").style.backgroundColor = "green";
            document.getElementById("message").style.color = "beige";
            document.getElementById("submit-button").disabled = false;
            document.getElementById("form").reset();

            setTimeout(function () {
              document.getElementById("message").textContent = "";
              document.getElementById("message").style.display = "none";
            }, 2600);
          })
          .catch(function (error) {
            // Handle errors, you can display an error message here
            console.error(error);
            document.getElementById("message").textContent =
              "An error occurred while submitting the form.";
            document.getElementById("message").style.display = "block";
          });
      });
    </script>
</body>
</html>

